var q=(P,f,p)=>new Promise((R,v)=>{var k=c=>{try{x(p.next(c))}catch(i){v(i)}},y=c=>{try{x(p.throw(c))}catch(i){v(i)}},x=c=>c.done?R(c.value):Promise.resolve(c.value).then(k,y);x((p=p.apply(P,f)).next())});import{c as ee,p as te,r as g,y as B,M as U,o as se,a as r,b as e,i as h,e as w,f as V,u as b,F as S,h as j,q as _,v as M,X as O,D as A,k as H,t as d,j as o,n as N,l as oe}from"./index-vTMLdgaR.js";import{t as m}from"./mosha-vue-toastify.es-D60yAzeo.js";/* empty css              */import{C as I}from"./clock-CLRl5x-h.js";import{C as J}from"./circle-check-big-BNN7vvov.js";import{P as ne}from"./plus-DvcC1J81.js";import{S as re}from"./search-BnNG55a9.js";/**
 * @license lucide-vue-next v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=ee("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),le={class:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8"},ae={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-8 gap-4"},de={class:"flex gap-3"},ue={class:"grid grid-cols-1 gap-4 sm:grid-cols-3 mb-8"},ce={class:"truncate text-sm font-medium text-gray-500"},ge={class:"mt-1 text-2xl font-semibold tracking-tight text-gray-900"},me={class:"mb-6"},pe={class:"flex space-x-2"},ye=["onClick"],be={class:"mb-6 flex items-center justify-between"},fe={class:"relative max-w-sm flex-grow"},ve={class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},xe={key:0,class:"ml-4"},he={key:0,class:"space-y-4"},we={key:0,class:"text-center py-12 bg-white rounded-lg border border-dashed border-gray-300"},_e={class:"flex items-start gap-4"},ke={class:"mt-1"},Se={key:0,class:"rounded-full bg-green-100 p-2"},je={key:1,class:"rounded-full bg-orange-100 p-2"},Ce={class:"flex-grow"},Qe={class:"flex justify-between items-start"},qe={class:"flex items-center gap-3 mb-1"},Me={class:"text-base font-semibold text-gray-900"},Ne={class:"text-xs font-mono text-gray-400"},Re={class:"text-sm text-gray-500 mb-4"},De={class:"bg-gray-50 rounded-lg p-4 mb-3 text-sm text-gray-800 font-medium whitespace-pre-wrap"},Le={key:0,class:"bg-green-50 rounded-lg p-4 text-sm border border-green-100"},Te={class:"text-green-800 font-medium pb-1 mb-1 border-b border-green-200/50 flex justify-between"},Ve={class:"text-xs opacity-75"},Ae=["innerHTML"],Pe={class:"text-xs text-gray-400 mt-2"},Fe={key:1,class:"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6",role:"dialog","aria-modal":"true"},ze={class:"relative transform overflow-hidden rounded-xl bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6"},Be={class:"absolute right-0 top-0 hidden pr-4 pt-4 sm:block"},Ue={class:"space-y-4"},Oe=["value"],He={class:"mt-6"},Ie=["disabled"],Je={key:0,class:"animate-spin h-4 w-4 text-white",viewBox:"0 0 24 24"},Ee={key:2,class:"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6",role:"dialog","aria-modal":"true"},Xe={class:"relative transform overflow-hidden rounded-xl bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6"},Ye={class:"absolute right-0 top-0 hidden pr-4 pt-4 sm:block"},$e={class:"space-y-4"},Ge=["value"],Ke=["value"],We={class:"mt-6"},Ze=["disabled"],et={key:0,class:"animate-spin h-4 w-4 text-white",viewBox:"0 0 24 24"},dt={__name:"Queries",setup(P){const f=te(),p=g("My Queries"),R=["My Queries"],v=g(""),k=g(!0),y=g([]),x=g([]),c=g(!1),i=g({tender:"",subject:"",description:""}),F=g(!1),u=g({tender:"",type:"",reason:""}),E=["Compliance Assessment","Technical Assessment"],D=()=>q(this,null,function*(){k.value=!0;try{const[n,t]=yield Promise.all([f.secureFetch("/api/method/supplier_portal.api.get_my_queries"),f.secureFetch("/api/method/supplier_portal.api.get_my_questionnaires")]),s=yield n.json(),a=yield t.json(),W=(s.message||[]).map(l=>({id:l.name,type:"Query",title:l.subject,ref:l.rfq,status:l.status,question:l.query,response:l.response,responseDate:l.response?"Answered":null,submitted:new Date(l.creation).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})})),Z=(a.message||[]).map(l=>({id:l.name,type:"Questionnaire",title:l.subject,ref:l.rfq,status:l.status,question:l.query,response:l.response,responseDate:l.response?"Answered":null,submitted:new Date(l.creation).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})}));y.value=[...W,...Z]}catch(n){console.error("Failed to fetch data:",n),m("Failed to load data",{type:"danger"})}finally{k.value=!1}}),X=()=>q(this,null,function*(){try{const t=yield(yield f.secureFetch("/api/resource/Request for Quotation?"+new URLSearchParams({fields:JSON.stringify(["name"]),limit_page_length:"50"}))).json();x.value=(t.data||[]).map(s=>s.name)}catch(n){console.error("Failed to fetch tenders:",n)}}),C=g(!1),Y=()=>q(this,null,function*(){if(!i.value.subject||!i.value.description||!i.value.tender){m("Please fill in all fields.",{type:"warning"});return}C.value=!0;try{const n=yield f.secureFetch("/api/method/supplier_portal.api.create_rfq_query",{method:"POST",body:JSON.stringify({subject:i.value.subject,rfq:i.value.tender,query:i.value.description})});if(n.ok){const t=yield n.json();m("Query submitted successfully",{type:"success"}),L(),i.value={subject:"",tender:"",description:""},D()}else{const t=yield n.json();console.error("Submission failed:",t),m(t.message||"Submission failed",{type:"danger"})}}catch(n){console.error("Network error:",n),m("Network error occurred. Please try again.",{type:"danger"})}finally{C.value=!1}}),Q=g(!1),$=()=>q(this,null,function*(){if(!u.value.tender||!u.value.type||!u.value.reason){m("Please fill in all fields.",{type:"warning"});return}Q.value=!0;try{const n=yield f.secureFetch("/api/method/supplier_portal.api.create_rfq_questionnaire",{method:"POST",body:JSON.stringify({rfq:u.value.tender,subject:u.value.type,query:u.value.reason})});if(n.ok)m("Questionnaire requested successfully",{type:"success"}),T(),u.value={tender:"",type:"",reason:""},D();else{const t=yield n.json();m(t.message||"Request failed",{type:"danger"})}}catch(n){console.error("Network error:",n),m("Network error occurred.",{type:"danger"})}finally{Q.value=!1}}),G=B(()=>{const n=y.value.filter(a=>a.type==="Query").length,t=y.value.filter(a=>a.type==="Query"&&a.status==="Pending").length,s=y.value.filter(a=>a.type==="Query"&&a.status==="Answered").length;return y.value.filter(a=>a.type==="Questionnaire").length,[{name:"Total Queries",value:n.toString(),icon:U,color:"text-blue-600",bg:"bg-blue-50"},{name:"Pending",value:t.toString(),icon:I,color:"text-orange-600",bg:"bg-orange-50"},{name:"Answered",value:s.toString(),icon:J,color:"text-green-600",bg:"bg-green-50"}]}),z=B(()=>{const n=p.value==="My Queries"?"Query":"Questionnaire";return y.value.filter(t=>{var s,a;return t.type===n&&(((s=t.title)==null?void 0:s.toLowerCase().includes(v.value.toLowerCase()))||((a=t.ref)==null?void 0:a.toLowerCase().includes(v.value.toLowerCase())))})}),K=()=>c.value=!0,L=()=>{c.value=!1,i.value={tender:"",subject:"",description:""}},T=()=>F.value=!1;return se(()=>{D(),X()}),(n,t)=>(o(),r("div",le,[e("div",ae,[t[8]||(t[8]=e("div",null,[e("h1",{class:"text-3xl font-bold tracking-tight text-gray-900"},"Queries"),e("p",{class:"mt-1 text-sm text-gray-500"},"Submit queries about tenders.")],-1)),e("div",de,[e("button",{onClick:K,class:"inline-flex items-center gap-2 rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500"},[w(b(ne),{class:"h-4 w-4"}),t[7]||(t[7]=V(" New Query ",-1))])])]),e("div",ue,[(o(!0),r(S,null,j(G.value,s=>(o(),r("div",{key:s.name,class:"rounded-lg bg-white px-6 py-8 shadow sm:p-6 border border-gray-100 flex items-center gap-6"},[e("div",{class:N([s.bg,"rounded-md p-3"])},[(o(),H(oe(s.icon),{class:N([s.color,"h-6 w-6"])},null,8,["class"]))],2),e("div",null,[e("dt",ce,d(s.name),1),e("dd",ge,d(s.value),1)])]))),128))]),e("div",me,[e("div",pe,[(o(),r(S,null,j(R,s=>e("button",{key:s,onClick:a=>p.value=s,class:N([p.value===s?"bg-gray-100 text-gray-900 font-semibold":"text-gray-500 hover:text-gray-700 hover:bg-gray-50","rounded-md px-3 py-2 text-sm font-medium transition-colors"])},d(s),11,ye)),64))])]),e("div",be,[e("div",fe,[e("div",ve,[w(b(re),{class:"h-4 w-4 text-gray-400"})]),_(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>v.value=s),type:"text",class:"block w-full rounded-md border-0 py-2 pl-10 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 shadow-sm",placeholder:"Search queries..."},null,512),[[M,v.value]])]),k.value?(o(),r("div",xe,[...t[9]||(t[9]=[e("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-indigo-600"},null,-1)])])):h("",!0)]),k.value?h("",!0):(o(),r("div",he,[z.value.length===0?(o(),r("div",we,[w(b(U),{class:"mx-auto h-12 w-12 text-gray-400"}),t[10]||(t[10]=e("h3",{class:"mt-2 text-sm font-semibold text-gray-900"},"No records found",-1)),t[11]||(t[11]=e("p",{class:"mt-1 text-sm text-gray-500"},"Submit a new query to see it listed here.",-1))])):h("",!0),(o(!0),r(S,null,j(z.value,s=>(o(),r("div",{key:s.id,class:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm hover:shadow-md transition-shadow"},[e("div",_e,[e("div",ke,[s.status==="Answered"?(o(),r("div",Se,[w(b(J),{class:"h-5 w-5 text-green-600"})])):(o(),r("div",je,[w(b(I),{class:"h-5 w-5 text-orange-600"})]))]),e("div",Ce,[e("div",Qe,[e("div",qe,[e("h3",Me,d(s.title),1),e("span",{class:N(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ring-1 ring-inset",s.status==="Answered"||s.status==="Completed"?"bg-green-50 text-green-700 ring-green-600/20":s.status==="Action Required"?"bg-indigo-50 text-indigo-700 ring-indigo-600/20":"bg-orange-50 text-orange-700 ring-orange-600/20"])},d(s.status),3)]),e("div",Ne,d(s.id),1)]),e("p",Re,d(s.ref),1),e("div",De,d(s.question),1),s.response?(o(),r("div",Le,[e("div",Te,[t[12]||(t[12]=e("span",null,"Response",-1)),e("span",Ve,d(s.responseDate),1)]),e("div",{class:"text-green-900 prose prose-sm max-w-none",innerHTML:s.response},null,8,Ae)])):h("",!0),e("p",Pe,"Submitted: "+d(s.submitted),1)])])]))),128))])),c.value?(o(),r("div",Fe,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:L}),e("div",ze,[e("div",Be,[e("button",{type:"button",class:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none",onClick:L},[t[13]||(t[13]=e("span",{class:"sr-only"},"Close",-1)),w(b(O),{class:"h-5 w-5","aria-hidden":"true"})])]),e("div",null,[t[19]||(t[19]=e("h3",{class:"text-lg font-bold leading-6 text-gray-900 mb-6",id:"modal-title"},"Submit New Query",-1)),e("div",Ue,[e("div",null,[t[15]||(t[15]=e("label",{for:"tender",class:"block text-sm font-semibold text-gray-900 mb-1.5"},"Select Tender",-1)),_(e("select",{id:"tender","onUpdate:modelValue":t[1]||(t[1]=s=>i.value.tender=s),class:"block w-full rounded-lg border-0 py-2.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[t[14]||(t[14]=e("option",{value:"",disabled:"",selected:""},"Select tender",-1)),(o(!0),r(S,null,j(x.value,s=>(o(),r("option",{key:s,value:s},d(s),9,Oe))),128))],512),[[A,i.value.tender]])]),e("div",null,[t[16]||(t[16]=e("label",{for:"subject",class:"block text-sm font-semibold text-gray-900 mb-1.5"},"Subject",-1)),_(e("input",{type:"text",id:"subject","onUpdate:modelValue":t[2]||(t[2]=s=>i.value.subject=s),placeholder:"Brief subject of your query",class:"block w-full rounded-lg border-0 py-2.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},null,512),[[M,i.value.subject]])]),e("div",null,[t[17]||(t[17]=e("label",{for:"query",class:"block text-sm font-semibold text-gray-900 mb-1.5"},"Your Query",-1)),_(e("textarea",{id:"query",rows:"4","onUpdate:modelValue":t[3]||(t[3]=s=>i.value.description=s),placeholder:"Describe your query in detail...",class:"block w-full rounded-lg border-0 py-2.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},null,512),[[M,i.value.description]])])]),e("div",He,[e("button",{onClick:Y,disabled:C.value,type:"button",class:"inline-flex w-full justify-center rounded-lg bg-indigo-600 px-3 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 gap-2 items-center transition-all disabled:opacity-50 disabled:cursor-not-allowed"},[C.value?(o(),r("svg",Je,[...t[18]||(t[18]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(o(),H(b(ie),{key:1,class:"h-4 w-4"})),V(" "+d(C.value?"Submitting...":"Submit Query"),1)],8,Ie)])])])])):h("",!0),F.value?(o(),r("div",Ee,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:T}),e("div",Xe,[e("div",Ye,[e("button",{type:"button",class:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none",onClick:T},[t[20]||(t[20]=e("span",{class:"sr-only"},"Close",-1)),w(b(O),{class:"h-5 w-5","aria-hidden":"true"})])]),e("div",null,[t[27]||(t[27]=e("h3",{class:"text-lg font-bold leading-6 text-gray-900 mb-6",id:"modal-title"},"Request Questionnaire",-1)),e("div",$e,[e("div",null,[t[22]||(t[22]=e("label",{for:"req-tender",class:"block text-sm font-semibold text-gray-900 mb-1.5"},"Select Tender",-1)),_(e("select",{id:"req-tender","onUpdate:modelValue":t[4]||(t[4]=s=>u.value.tender=s),class:"block w-full rounded-lg border-0 py-2.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[t[21]||(t[21]=e("option",{value:"",disabled:"",selected:""},"Select tender",-1)),(o(!0),r(S,null,j(x.value,s=>(o(),r("option",{key:s,value:s},d(s),9,Ge))),128))],512),[[A,u.value.tender]])]),e("div",null,[t[24]||(t[24]=e("label",{for:"req-type",class:"block text-sm font-semibold text-gray-900 mb-1.5"},"Type of Questionnaire",-1)),_(e("select",{id:"req-type","onUpdate:modelValue":t[5]||(t[5]=s=>u.value.type=s),class:"block w-full rounded-lg border-0 py-2.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[t[23]||(t[23]=e("option",{value:"",disabled:"",selected:""},"Select type",-1)),(o(),r(S,null,j(E,s=>e("option",{key:s,value:s},d(s),9,Ke)),64))],512),[[A,u.value.type]])]),e("div",null,[t[25]||(t[25]=e("label",{for:"req-reason",class:"block text-sm font-semibold text-gray-900 mb-1.5"},"Reason for Request",-1)),_(e("textarea",{id:"req-reason",rows:"4","onUpdate:modelValue":t[6]||(t[6]=s=>u.value.reason=s),placeholder:"Explain why you need this questionnaire...",class:"block w-full rounded-lg border-0 py-2.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},null,512),[[M,u.value.reason]])])]),e("div",We,[e("button",{onClick:$,disabled:Q.value,type:"button",class:"inline-flex w-full justify-center rounded-lg bg-indigo-600 px-3 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 gap-2 items-center transition-all disabled:opacity-50 disabled:cursor-not-allowed"},[Q.value?(o(),r("svg",et,[...t[26]||(t[26]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):h("",!0),V(" "+d(Q.value?"Submitting...":"Submit Request"),1)],8,Ze)])])])])):h("",!0)]))}};export{dt as default};
//# sourceMappingURL=Queries-CAp5wPQm.js.map
