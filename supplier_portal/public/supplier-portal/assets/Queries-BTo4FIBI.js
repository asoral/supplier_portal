var ce=Object.defineProperty,ge=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var W=(p,a,u)=>a in p?ce(p,a,{enumerable:!0,configurable:!0,writable:!0,value:u}):p[a]=u,F=(p,a)=>{for(var u in a||(a={}))me.call(a,u)&&W(p,u,a[u]);if(J)for(var u of J(a))ye.call(a,u)&&W(p,u,a[u]);return p},O=(p,a)=>ge(p,pe(a));var _=(p,a,u)=>new Promise((Q,v)=>{var b=r=>{try{h(u.next(r))}catch(w){v(w)}},R=r=>{try{h(u.throw(r))}catch(w){v(w)}},h=r=>r.done?Q(r.value):Promise.resolve(r.value).then(b,R);h((u=u.apply(p,a)).next())});import{c as te,m,y as Y,M as $,p as fe,a as l,b as e,k as S,e as x,f as D,u as y,j as be,F as j,r as q,q as C,v as V,X as G,C as U,h as K,t as c,o as i,n as P,i as xe}from"./index-BSCMUMd1.js";import{t as f}from"./mosha-vue-toastify.es-D47hDG2w.js";/* empty css              */import{C as Z}from"./clock-DqnnWosP.js";import{C as ee}from"./circle-check-big-YGB-uiQM.js";import{P as ve}from"./plus-BhCNQH2P.js";import{S as he}from"./search-C48IUDqy.js";/**
 * @license lucide-vue-next v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=te("file-question-mark",[["path",{d:"M12 17h.01",key:"p32p05"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}],["path",{d:"M9.1 9a3 3 0 0 1 5.82 1c0 2-3 3-3 3",key:"mhlwft"}]]);/**
 * @license lucide-vue-next v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=te("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),_e={class:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8"},Se={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-8 gap-4"},Ce={class:"flex gap-3"},Qe={class:"grid grid-cols-1 gap-4 sm:grid-cols-4 mb-8"},je={class:"truncate text-sm font-medium text-gray-500"},qe={class:"mt-1 text-2xl font-semibold tracking-tight text-gray-900"},Re={class:"mb-6"},Me={class:"flex space-x-2"},Te=["onClick"],Le={class:"mb-6 flex items-center justify-between"},Ne={class:"relative max-w-sm flex-grow"},Fe={class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},De={key:0,class:"ml-4"},Ve={key:0,class:"space-y-4"},Pe={key:0,class:"text-center py-12 bg-white rounded-lg border border-dashed border-gray-300"},Ae={class:"flex items-start gap-4"},ze={class:"mt-1"},Be={key:0,class:"rounded-full bg-green-100 p-2"},Oe={key:1,class:"rounded-full bg-orange-100 p-2"},Ue={class:"flex-grow"},He={class:"flex justify-between items-start"},Xe={class:"flex items-center gap-3 mb-1"},Ee={class:"text-base font-semibold text-gray-900"},Ie={class:"text-xs font-mono text-gray-400"},Je={class:"text-sm text-gray-500 mb-4"},We={class:"bg-gray-50 rounded-lg p-4 mb-3 text-sm text-gray-800 font-medium whitespace-pre-wrap"},Ye={key:0,class:"bg-green-50 rounded-lg p-4 text-sm border border-green-100"},$e={class:"text-green-800 font-medium pb-1 mb-1 border-b border-green-200/50 flex justify-between"},Ge={class:"text-xs opacity-75"},Ke=["innerHTML"],Ze={class:"text-xs text-gray-400 mt-2"},et={key:1,class:"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6",role:"dialog","aria-modal":"true"},tt={class:"relative transform overflow-hidden rounded-xl bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6"},st={class:"absolute right-0 top-0 hidden pr-4 pt-4 sm:block"},ot={class:"space-y-4"},nt=["value"],it={class:"mt-6"},rt=["disabled"],lt={key:0,class:"animate-spin h-4 w-4 text-white",viewBox:"0 0 24 24"},at={key:2,class:"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6",role:"dialog","aria-modal":"true"},dt={class:"relative transform overflow-hidden rounded-xl bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6"},ut={class:"absolute right-0 top-0 hidden pr-4 pt-4 sm:block"},ct={class:"space-y-4"},gt=["value"],pt=["value"],mt={class:"mt-6"},yt=["disabled"],ft={key:0,class:"animate-spin h-4 w-4 text-white",viewBox:"0 0 24 24"},Ct={__name:"Queries",setup(p){const a=m("My Queries"),u=["My Queries","Questionnaires"],Q=m(""),v=m(!0),b=m([]),R=m([]),h=m(!1),r=m({tender:"",subject:"",description:""}),w=m(!1),g=m({tender:"",type:"",reason:""}),se=["Compliance Assessment","Technical Assessment"],A=()=>_(this,null,function*(){v.value=!0;try{const o={"X-Requested-With":"XMLHttpRequest"},[t,s]=yield Promise.all([fetch("/api/method/supplier_portal.api.get_my_queries",{credentials:"include",headers:o}),fetch("/api/method/supplier_portal.api.get_my_questionnaires",{credentials:"include",headers:o})]),k=yield t.json(),d=yield s.json(),L=(k.message||[]).map(n=>({id:n.name,type:"Query",title:n.subject,ref:n.rfq,status:n.status,question:n.query,response:n.response,responseDate:n.response?"Answered":null,submitted:new Date(n.creation).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})})),N=(d.message||[]).map(n=>({id:n.name,type:"Questionnaire",title:n.subject,ref:n.rfq,status:n.status,question:n.query,response:n.response,responseDate:n.response?"Answered":null,submitted:new Date(n.creation).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})}));b.value=[...L,...N]}catch(o){console.error("Failed to fetch data:",o),f("Failed to load data",{type:"danger"})}finally{v.value=!1}}),oe=()=>_(this,null,function*(){try{const t=yield(yield fetch("/api/resource/Request for Quotation?"+new URLSearchParams({fields:JSON.stringify(["name"]),limit_page_length:50}),{credentials:"include"})).json();R.value=(t.data||[]).map(s=>s.name)}catch(o){console.error("Failed to fetch tenders:",o)}}),M=m(!1),H=()=>_(this,null,function*(){try{const t=yield(yield fetch("/api/method/supplier_portal.api.get_csrf_token",{credentials:"include",cache:"no-store"})).json();if(t.message)return window.csrf_token=t.message,t.message}catch(o){console.error("Failed to refresh CSRF token",o)}return window.csrf_token}),X=(s,...k)=>_(this,[s,...k],function*(o,t={}){let d=window.csrf_token;(!d||d==="None")&&(d=yield H());const L=F({"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-Frappe-CSRF-Token":d},t.headers||{}),N=O(F({},t),{headers:L,credentials:"include"});let n=yield fetch(o,N);if(!n.ok)try{const I=yield n.clone().json();(I.exc_type==="CSRFTokenError"||n.status===403||n.status===417||n.status===400)&&(console.warn("CSRF Error, retrying...",I.exc_type),yield new Promise(ue=>setTimeout(ue,500)),d=yield H(),L["X-Frappe-CSRF-Token"]=d,n=yield fetch(o,O(F({},N),{headers:L})))}catch(de){}return n}),ne=()=>_(this,null,function*(){if(!r.value.subject||!r.value.description||!r.value.tender){f("Please fill in all fields.",{type:"warning"});return}M.value=!0;try{const o=yield X("/api/method/supplier_portal.api.create_rfq_query",{method:"POST",body:JSON.stringify({subject:r.value.subject,rfq:r.value.tender,query:r.value.description}),credentials:"include"});if(o.ok){const t=yield o.json();f("Query submitted successfully",{type:"success"}),z(),r.value={subject:"",tender:"",description:""},A()}else{const t=yield o.json();console.error("Submission failed:",t),f(t.message||"Submission failed",{type:"danger"})}}catch(o){console.error("Network error:",o),f("Network error occurred. Please try again.",{type:"danger"})}finally{M.value=!1}}),T=m(!1),ie=()=>_(this,null,function*(){if(!g.value.tender||!g.value.type||!g.value.reason){f("Please fill in all fields.",{type:"warning"});return}T.value=!0;try{const o=yield X("/api/method/supplier_portal.api.create_rfq_questionnaire",{method:"POST",body:JSON.stringify({rfq:g.value.tender,subject:g.value.type,query:g.value.reason}),credentials:"include"});if(o.ok)f("Questionnaire requested successfully",{type:"success"}),B(),g.value={tender:"",type:"",reason:""},A();else{const t=yield o.json();f(t.message||"Request failed",{type:"danger"})}}catch(o){console.error("Network error:",o),f("Network error occurred.",{type:"danger"})}finally{T.value=!1}}),re=Y(()=>{const o=b.value.filter(d=>d.type==="Query").length,t=b.value.filter(d=>d.type==="Query"&&d.status==="Pending").length,s=b.value.filter(d=>d.type==="Query"&&d.status==="Answered").length,k=b.value.filter(d=>d.type==="Questionnaire").length;return[{name:"Total Queries",value:o.toString(),icon:$,color:"text-blue-600",bg:"bg-blue-50"},{name:"Pending",value:t.toString(),icon:Z,color:"text-orange-600",bg:"bg-orange-50"},{name:"Answered",value:s.toString(),icon:ee,color:"text-green-600",bg:"bg-green-50"},{name:"Questionnaires",value:k.toString(),icon:we,color:"text-indigo-600",bg:"bg-indigo-50"}]}),E=Y(()=>{const o=a.value==="My Queries"?"Query":"Questionnaire";return b.value.filter(t=>{var s,k;return t.type===o&&(((s=t.title)==null?void 0:s.toLowerCase().includes(Q.value.toLowerCase()))||((k=t.ref)==null?void 0:k.toLowerCase().includes(Q.value.toLowerCase())))})}),le=()=>h.value=!0,z=()=>{h.value=!1,r.value={tender:"",subject:"",description:""}},ae=()=>w.value=!0,B=()=>w.value=!1;return fe(()=>{A(),oe()}),(o,t)=>(i(),l("div",_e,[e("div",Se,[t[9]||(t[9]=e("div",null,[e("h1",{class:"text-3xl font-bold tracking-tight text-gray-900"},"Queries & Questionnaires"),e("p",{class:"mt-1 text-sm text-gray-500"},"Submit queries about tenders and respond to questionnaires.")],-1)),e("div",Ce,[e("button",{onClick:ae,class:"inline-flex items-center gap-2 rounded-md bg-white px-4 py-2 text-sm font-semibold text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50"},[x(y(be),{class:"h-4 w-4"}),t[7]||(t[7]=D(" Request Questionnaire ",-1))]),e("button",{onClick:le,class:"inline-flex items-center gap-2 rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500"},[x(y(ve),{class:"h-4 w-4"}),t[8]||(t[8]=D(" New Query ",-1))])])]),e("div",Qe,[(i(!0),l(j,null,q(re.value,s=>(i(),l("div",{key:s.name,class:"rounded-lg bg-white px-4 py-5 shadow sm:p-6 border border-gray-100 flex items-center gap-4"},[e("div",{class:P([s.bg,"rounded-md p-3"])},[(i(),K(xe(s.icon),{class:P([s.color,"h-6 w-6"])},null,8,["class"]))],2),e("div",null,[e("dt",je,c(s.name),1),e("dd",qe,c(s.value),1)])]))),128))]),e("div",Re,[e("div",Me,[(i(),l(j,null,q(u,s=>e("button",{key:s,onClick:k=>a.value=s,class:P([a.value===s?"bg-gray-100 text-gray-900 font-semibold":"text-gray-500 hover:text-gray-700 hover:bg-gray-50","rounded-md px-3 py-2 text-sm font-medium transition-colors"])},c(s),11,Te)),64))])]),e("div",Le,[e("div",Ne,[e("div",Fe,[x(y(he),{class:"h-4 w-4 text-gray-400"})]),C(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>Q.value=s),type:"text",class:"block w-full rounded-md border-0 py-2 pl-10 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 shadow-sm",placeholder:"Search queries..."},null,512),[[V,Q.value]])]),v.value?(i(),l("div",De,[...t[10]||(t[10]=[e("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-indigo-600"},null,-1)])])):S("",!0)]),v.value?S("",!0):(i(),l("div",Ve,[E.value.length===0?(i(),l("div",Pe,[x(y($),{class:"mx-auto h-12 w-12 text-gray-400"}),t[11]||(t[11]=e("h3",{class:"mt-2 text-sm font-semibold text-gray-900"},"No records found",-1)),t[12]||(t[12]=e("p",{class:"mt-1 text-sm text-gray-500"},"Submit a new query to see it listed here.",-1))])):S("",!0),(i(!0),l(j,null,q(E.value,s=>(i(),l("div",{key:s.id,class:"rounded-lg border border-gray-200 bg-white p-6 shadow-sm hover:shadow-md transition-shadow"},[e("div",Ae,[e("div",ze,[s.status==="Answered"?(i(),l("div",Be,[x(y(ee),{class:"h-5 w-5 text-green-600"})])):(i(),l("div",Oe,[x(y(Z),{class:"h-5 w-5 text-orange-600"})]))]),e("div",Ue,[e("div",He,[e("div",Xe,[e("h3",Ee,c(s.title),1),e("span",{class:P(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ring-1 ring-inset",s.status==="Answered"||s.status==="Completed"?"bg-green-50 text-green-700 ring-green-600/20":s.status==="Action Required"?"bg-indigo-50 text-indigo-700 ring-indigo-600/20":"bg-orange-50 text-orange-700 ring-orange-600/20"])},c(s.status),3)]),e("div",Ie,c(s.id),1)]),e("p",Je,c(s.ref),1),e("div",We,c(s.question),1),s.response?(i(),l("div",Ye,[e("div",$e,[t[13]||(t[13]=e("span",null,"Response",-1)),e("span",Ge,c(s.responseDate),1)]),e("div",{class:"text-green-900 prose prose-sm max-w-none",innerHTML:s.response},null,8,Ke)])):S("",!0),e("p",Ze,"Submitted: "+c(s.submitted),1)])])]))),128))])),h.value?(i(),l("div",et,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:z}),e("div",tt,[e("div",st,[e("button",{type:"button",class:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none",onClick:z},[t[14]||(t[14]=e("span",{class:"sr-only"},"Close",-1)),x(y(G),{class:"h-5 w-5","aria-hidden":"true"})])]),e("div",null,[t[20]||(t[20]=e("h3",{class:"text-lg font-bold leading-6 text-gray-900 mb-6",id:"modal-title"},"Submit New Query",-1)),e("div",ot,[e("div",null,[t[16]||(t[16]=e("label",{for:"tender",class:"block text-sm font-semibold text-gray-900 mb-1.5"},"Select Tender",-1)),C(e("select",{id:"tender","onUpdate:modelValue":t[1]||(t[1]=s=>r.value.tender=s),class:"block w-full rounded-lg border-0 py-2.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[t[15]||(t[15]=e("option",{value:"",disabled:"",selected:""},"Select tender",-1)),(i(!0),l(j,null,q(R.value,s=>(i(),l("option",{key:s,value:s},c(s),9,nt))),128))],512),[[U,r.value.tender]])]),e("div",null,[t[17]||(t[17]=e("label",{for:"subject",class:"block text-sm font-semibold text-gray-900 mb-1.5"},"Subject",-1)),C(e("input",{type:"text",id:"subject","onUpdate:modelValue":t[2]||(t[2]=s=>r.value.subject=s),placeholder:"Brief subject of your query",class:"block w-full rounded-lg border-0 py-2.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},null,512),[[V,r.value.subject]])]),e("div",null,[t[18]||(t[18]=e("label",{for:"query",class:"block text-sm font-semibold text-gray-900 mb-1.5"},"Your Query",-1)),C(e("textarea",{id:"query",rows:"4","onUpdate:modelValue":t[3]||(t[3]=s=>r.value.description=s),placeholder:"Describe your query in detail...",class:"block w-full rounded-lg border-0 py-2.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},null,512),[[V,r.value.description]])])]),e("div",it,[e("button",{onClick:ne,disabled:M.value,type:"button",class:"inline-flex w-full justify-center rounded-lg bg-indigo-600 px-3 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 gap-2 items-center transition-all disabled:opacity-50 disabled:cursor-not-allowed"},[M.value?(i(),l("svg",lt,[...t[19]||(t[19]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(i(),K(y(ke),{key:1,class:"h-4 w-4"})),D(" "+c(M.value?"Submitting...":"Submit Query"),1)],8,rt)])])])])):S("",!0),w.value?(i(),l("div",at,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:B}),e("div",dt,[e("div",ut,[e("button",{type:"button",class:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none",onClick:B},[t[21]||(t[21]=e("span",{class:"sr-only"},"Close",-1)),x(y(G),{class:"h-5 w-5","aria-hidden":"true"})])]),e("div",null,[t[28]||(t[28]=e("h3",{class:"text-lg font-bold leading-6 text-gray-900 mb-6",id:"modal-title"},"Request Questionnaire",-1)),e("div",ct,[e("div",null,[t[23]||(t[23]=e("label",{for:"req-tender",class:"block text-sm font-semibold text-gray-900 mb-1.5"},"Select Tender",-1)),C(e("select",{id:"req-tender","onUpdate:modelValue":t[4]||(t[4]=s=>g.value.tender=s),class:"block w-full rounded-lg border-0 py-2.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[t[22]||(t[22]=e("option",{value:"",disabled:"",selected:""},"Select tender",-1)),(i(!0),l(j,null,q(R.value,s=>(i(),l("option",{key:s,value:s},c(s),9,gt))),128))],512),[[U,g.value.tender]])]),e("div",null,[t[25]||(t[25]=e("label",{for:"req-type",class:"block text-sm font-semibold text-gray-900 mb-1.5"},"Type of Questionnaire",-1)),C(e("select",{id:"req-type","onUpdate:modelValue":t[5]||(t[5]=s=>g.value.type=s),class:"block w-full rounded-lg border-0 py-2.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},[t[24]||(t[24]=e("option",{value:"",disabled:"",selected:""},"Select type",-1)),(i(),l(j,null,q(se,s=>e("option",{key:s,value:s},c(s),9,pt)),64))],512),[[U,g.value.type]])]),e("div",null,[t[26]||(t[26]=e("label",{for:"req-reason",class:"block text-sm font-semibold text-gray-900 mb-1.5"},"Reason for Request",-1)),C(e("textarea",{id:"req-reason",rows:"4","onUpdate:modelValue":t[6]||(t[6]=s=>g.value.reason=s),placeholder:"Explain why you need this questionnaire...",class:"block w-full rounded-lg border-0 py-2.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"},null,512),[[V,g.value.reason]])])]),e("div",mt,[e("button",{onClick:ie,disabled:T.value,type:"button",class:"inline-flex w-full justify-center rounded-lg bg-indigo-600 px-3 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 gap-2 items-center transition-all disabled:opacity-50 disabled:cursor-not-allowed"},[T.value?(i(),l("svg",ft,[...t[27]||(t[27]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):S("",!0),D(" "+c(T.value?"Submitting...":"Submit Request"),1)],8,yt)])])])])):S("",!0)]))}};export{Ct as default};
//# sourceMappingURL=Queries-BTo4FIBI.js.map
